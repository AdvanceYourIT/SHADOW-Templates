{
  "name": "CF-UltraTreesizeNinja",
  "description": "https://github.com/freezscholte/Public-Ninja-Scripts/blob/main/CF-Treesize/CF-UltraTreesizeNinja.ps1",
  "categoriesIds": [
    3
  ],
  "architecture": [
    "64",
    "32"
  ],
  "language": "powershell",
  "operatingSystems": [
    "Windows"
  ],
  "code": "CjwjCi5TWU5PUFNJUwogICAgQ2FsY3VsYXRlIHRoZSBzaXplcyBvZiBmb2xkZXJzIGZyb20gdGhlIE1hc3RlciBGaWxlIFRhYmxlIHVzaW5nIEMjIG9uIGEgZHJpdmUgYW5kIG91dHB1dCB0aGUgcmVzdWx0cyBpbiBhbiBIVE1MIHRhYmxlLgoKLkRFU0NSSVBUSU9OCiAgICBUaGlzIHNjcmlwdCBjYWxjdWxhdGVzIHRoZSBzaXplcyBvZiBmb2xkZXJzIGZyb20gdGhlIE1hc3RlciBGaWxlIFRhYmxlIChNRlQpIHVzaW5nIEMjIG9uIGEgc3BlY2lmaWVkIGRyaXZlIGFuZCBvdXRwdXRzIHRoZSByZXN1bHRzIGluIGFuIEhUTUwgdGFibGUuCiAgICBUaGUgc2NyaXB0IHVzZXMgYSBjb21waWxlZCBDIyBjbGFzcyB0byByZWFkIHRoZSBNRlQgcmVjb3JkcyBhbmQgY2FsY3VsYXRlIHRoZSBzaXplcyBvZiBmb2xkZXJzIHJlY3Vyc2l2ZWx5LgogICAgVGhlIHJlc3VsdHMgYXJlIGRpc3BsYXllZCBpbiBhbiBIVE1MIHRhYmxlIHdpdGggdGhlIHRvcCBmb2xkZXJzIGJ5IHNpemUsIGFuZCB0aGUgcm93IGNvbG9yIGlzIGJhc2VkIG9uIHRoZSBzaXplIG9mIHRoZSBmb2xkZXIuCgouTk9URVMKICAgIEZpbGUgTmFtZSAgICAgIDogQ0YtVWx0cmFUcmVlc2l6ZU5pbmphLnBzMQogICAgQXV0aG9yICAgICAgICAgOiBKYW4gU2Nob2x0ZQogICAgVmVyc2lvbiAgICAgICAgOiAwLjkuMSBSQwojPgoKQWRkLVR5cGUgLVR5cGVEZWZpbml0aW9uIEAiCnVzaW5nIFN5c3RlbTsKdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkNvbmN1cnJlbnQ7CnVzaW5nIFN5c3RlbS5JTzsKdXNpbmcgU3lzdGVtLkxpbnE7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmc7CnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7CnVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsKdXNpbmcgU3lzdGVtLkNvbXBvbmVudE1vZGVsOwoKbmFtZXNwYWNlIEZvbGRlclNpemVDYWxjdWxhdG9yTmFtZXNwYWNlCnsKICAgIHB1YmxpYyBjbGFzcyBGaWxlU3lzdGVtSXRlbQogICAgewogICAgICAgIHB1YmxpYyBzdHJpbmcgUGF0aCB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIGxvbmcgU2l6ZU9uRGlzayB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIERhdGVUaW1lIENyZWF0aW9uVGltZSB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIERhdGVUaW1lIExhc3RXcml0ZVRpbWUgeyBnZXQ7IHNldDsgfQogICAgICAgIHB1YmxpYyBib29sIElzRGlyZWN0b3J5IHsgZ2V0OyBzZXQ7IH0KICAgIH0KCiAgICBwdWJsaWMgY2xhc3MgRm9sZGVyU2l6ZUNhbGN1bGF0b3IKICAgIHsKICAgICAgICBwcml2YXRlIHN0cmluZyBkcml2ZUxldHRlcjsKICAgICAgICBwcml2YXRlIGludCBtYXhEZXB0aDsKICAgICAgICBwcml2YXRlIGJvb2wgdmVyYm9zZU91dHB1dDsKICAgICAgICBwcml2YXRlIGxvbmcgc2l6ZVRocmVzaG9sZDsKICAgICAgICBwdWJsaWMgQ29uY3VycmVudEJhZzxGaWxlU3lzdGVtSXRlbT4gSXRlbXMgeyBnZXQ7IHByaXZhdGUgc2V0OyB9CgogICAgICAgIHB1YmxpYyBGb2xkZXJTaXplQ2FsY3VsYXRvcihzdHJpbmcgZHJpdmVMZXR0ZXIsIGludCBtYXhEZXB0aCwgYm9vbCB2ZXJib3NlT3V0cHV0LCBsb25nIHNpemVUaHJlc2hvbGQgPSAxMDI0ICogMTAyNCkKICAgICAgICB7CiAgICAgICAgICAgIHRoaXMuZHJpdmVMZXR0ZXIgPSBkcml2ZUxldHRlcjsKICAgICAgICAgICAgdGhpcy5tYXhEZXB0aCA9IG1heERlcHRoOwogICAgICAgICAgICB0aGlzLnZlcmJvc2VPdXRwdXQgPSB2ZXJib3NlT3V0cHV0OwogICAgICAgICAgICB0aGlzLnNpemVUaHJlc2hvbGQgPSBzaXplVGhyZXNob2xkOwogICAgICAgICAgICB0aGlzLkl0ZW1zID0gbmV3IENvbmN1cnJlbnRCYWc8RmlsZVN5c3RlbUl0ZW0+KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBDYWxjdWxhdGVGb2xkZXJTaXplcygpCiAgICAgICAgewogICAgICAgICAgICBEaXJlY3RvcnlJbmZvIHJvb3REaXIgPSBuZXcgRGlyZWN0b3J5SW5mbyh0aGlzLmRyaXZlTGV0dGVyICsgIjpcXCIpOwogICAgICAgICAgICBDYWxjdWxhdGVGb2xkZXJTaXplKHJvb3REaXIsIDApOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBsb25nIENhbGN1bGF0ZUZvbGRlclNpemUoRGlyZWN0b3J5SW5mbyBkaXJJbmZvLCBpbnQgY3VycmVudERlcHRoKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnREZXB0aCA+IHRoaXMubWF4RGVwdGgpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb25nIGZvbGRlclNpemVPbkRpc2sgPSAwOwoKICAgICAgICAgICAgdmFyIHBhcmFsbGVsT3B0aW9ucyA9IG5ldyBQYXJhbGxlbE9wdGlvbnMgeyBNYXhEZWdyZWVPZlBhcmFsbGVsaXNtID0gRW52aXJvbm1lbnQuUHJvY2Vzc29yQ291bnQgfTsKCiAgICAgICAgICAgIHRyeQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGZpbGVzIGluIHRoZSBjdXJyZW50IGRpcmVjdG9yeQogICAgICAgICAgICAgICAgdmFyIGZpbGVzID0gRW51bWVyYWJsZS5FbXB0eTxGaWxlSW5mbz4oKTsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGZpbGVzID0gZGlySW5mby5FbnVtZXJhdGVGaWxlcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJib3NlT3V0cHV0KQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkVycm9yIGFjY2Vzc2luZyBmaWxlcyBpbiBkaXJlY3RvcnkgezB9OiB7MX0iLCBkaXJJbmZvLkZ1bGxOYW1lLCBleC5NZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgUGFyYWxsZWwuRm9yRWFjaChmaWxlcywgcGFyYWxsZWxPcHRpb25zLCBmaWxlID0+CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb25nIGZpbGVTaXplT25EaXNrID0gR2V0U2l6ZU9uRGlzayhmaWxlLkZ1bGxOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBuZXcgRmlsZVN5c3RlbUl0ZW0KICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCA9IGZpbGUuRnVsbE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplT25EaXNrID0gZmlsZVNpemVPbkRpc2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDcmVhdGlvblRpbWUgPSBmaWxlLkNyZWF0aW9uVGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExhc3RXcml0ZVRpbWUgPSBmaWxlLkxhc3RXcml0ZVRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJc0RpcmVjdG9yeSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlU2l6ZU9uRGlzayA+IHNpemVUaHJlc2hvbGQpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW1zLkFkZChpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgSW50ZXJsb2NrZWQuQWRkKHJlZiBmb2xkZXJTaXplT25EaXNrLCBmaWxlU2l6ZU9uRGlzayk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJib3NlT3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiRXJyb3IgcHJvY2Vzc2luZyBmaWxlIHswfTogezF9IiwgZmlsZS5GdWxsTmFtZSwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIHN1YmRpcmVjdG9yaWVzCiAgICAgICAgICAgICAgICB2YXIgc3ViRGlycyA9IEVudW1lcmFibGUuRW1wdHk8RGlyZWN0b3J5SW5mbz4oKTsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHN1YkRpcnMgPSBkaXJJbmZvLkVudW1lcmF0ZURpcmVjdG9yaWVzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlcmJvc2VPdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiRXJyb3IgYWNjZXNzaW5nIHN1YmRpcmVjdG9yaWVzIGluIGRpcmVjdG9yeSB7MH06IHsxfSIsIGRpckluZm8uRnVsbE5hbWUsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBQYXJhbGxlbC5Gb3JFYWNoKHN1YkRpcnMsIHBhcmFsbGVsT3B0aW9ucywgc3ViRGlyID0+CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBsb25nIHN1YkRpclNpemVPbkRpc2sgPSBDYWxjdWxhdGVGb2xkZXJTaXplKHN1YkRpciwgY3VycmVudERlcHRoICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIEludGVybG9ja2VkLkFkZChyZWYgZm9sZGVyU2l6ZU9uRGlzaywgc3ViRGlyU2l6ZU9uRGlzayk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJib3NlT3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiRXJyb3IgcHJvY2Vzc2luZyBkaXJlY3RvcnkgezB9OiB7MX0iLCBzdWJEaXIuRnVsbE5hbWUsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIEZpbGVTeXN0ZW1JdGVtIGZvciB0aGUgY3VycmVudCBkaXJlY3RvcnkKICAgICAgICAgICAgICAgIHZhciBkaXJJdGVtID0gbmV3IEZpbGVTeXN0ZW1JdGVtCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgUGF0aCA9IGRpckluZm8uRnVsbE5hbWUsCiAgICAgICAgICAgICAgICAgICAgU2l6ZU9uRGlzayA9IGZvbGRlclNpemVPbkRpc2ssCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRpb25UaW1lID0gZGlySW5mby5DcmVhdGlvblRpbWUsCiAgICAgICAgICAgICAgICAgICAgTGFzdFdyaXRlVGltZSA9IGRpckluZm8uTGFzdFdyaXRlVGltZSwKICAgICAgICAgICAgICAgICAgICBJc0RpcmVjdG9yeSA9IHRydWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBJdGVtcy5BZGQoZGlySXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHRoaXMudmVyYm9zZU91dHB1dCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiRXJyb3IgYWNjZXNzaW5nIGRpcmVjdG9yeSB7MH06IHsxfSIsIGRpckluZm8uRnVsbE5hbWUsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZm9sZGVyU2l6ZU9uRGlzazsKICAgICAgICB9CgogICAgICAgIFtEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIFNldExhc3RFcnJvciA9IHRydWUsIENoYXJTZXQgPSBDaGFyU2V0LkF1dG8pXQogICAgICAgIHN0YXRpYyBleHRlcm4gdWludCBHZXRDb21wcmVzc2VkRmlsZVNpemUoc3RyaW5nIGxwRmlsZU5hbWUsIG91dCB1aW50IGxwRmlsZVNpemVIaWdoKTsKCiAgICAgICAgcHVibGljIHN0YXRpYyBsb25nIEdldFNpemVPbkRpc2soc3RyaW5nIGZpbGVuYW1lKQogICAgICAgIHsKICAgICAgICAgICAgdWludCBoaWdoT3JkZXI7CiAgICAgICAgICAgIHVpbnQgbG93T3JkZXIgPSBHZXRDb21wcmVzc2VkRmlsZVNpemUoZmlsZW5hbWUsIG91dCBoaWdoT3JkZXIpOwogICAgICAgICAgICBpZiAobG93T3JkZXIgPT0gMHhGRkZGRkZGRikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaW50IGVycm9yID0gTWFyc2hhbC5HZXRMYXN0V2luMzJFcnJvcigpOwogICAgICAgICAgICAgICAgaWYgKGVycm9yICE9IDApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFdpbjMyRXhjZXB0aW9uKGVycm9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKChsb25nKWhpZ2hPcmRlciA8PCAzMikgKyBsb3dPcmRlcjsKICAgICAgICB9CiAgICB9Cn0KIkAKZnVuY3Rpb24gR2V0LUZvbGRlclNpemVzIHsKICAgIHBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRmYWxzZSldCiAgICAgICAgW3N0cmluZ10kRHJpdmVMZXR0ZXIsCiAgICAgICAgW2ludF0kTWF4RGVwdGggPSA1LAogICAgICAgIFtpbnRdJFRvcCA9IDIwLAogICAgICAgIFtTd2l0Y2hdJEZvbGRlclNpemUsCiAgICAgICAgW1N3aXRjaF0kRmlsZVNpemUsCiAgICAgICAgW1N3aXRjaF0kVmVyYm9zZU91dHB1dCwKICAgICAgICBbU3dpdGNoXSRBbGxEcml2ZXMKICAgICkKCiAgICAjIFZhbGlkYXRlIHBhcmFtZXRlcnMKICAgIGlmICgtbm90ICRBbGxEcml2ZXMgLWFuZCAtbm90ICREcml2ZUxldHRlcikgewogICAgICAgIHRocm93ICJZb3UgbXVzdCBzcGVjaWZ5IGVpdGhlciAtRHJpdmVMZXR0ZXIgb3IgLUFsbERyaXZlcy4iCiAgICB9CgogICAgIyBHZXQgbGlzdCBvZiBkcml2ZXMgdG8gcHJvY2VzcwogICAgJGRyaXZlc1RvUHJvY2VzcyA9IEAoKQogICAgaWYgKCRBbGxEcml2ZXMpIHsKICAgICAgICAjIEdldCBhbGwgbG9jYWwgZHJpdmVzIChleGNsdWRpbmcgcmVtb3ZhYmxlIGFuZCBuZXR3b3JrIGRyaXZlcykKICAgICAgICAkZHJpdmVzID0gR2V0LUNpbUluc3RhbmNlIFdpbjMyX0xvZ2ljYWxEaXNrIHwgV2hlcmUtT2JqZWN0IHsKICAgICAgICAgICAgJF8uRHJpdmVUeXBlIC1lcSAzICMgRHJpdmVUeXBlIDMgPSBMb2NhbCBEaXNrCiAgICAgICAgfQogICAgICAgICRkcml2ZXNUb1Byb2Nlc3MgPSAkZHJpdmVzLkRldmljZUlECiAgICB9IGVsc2UgewogICAgICAgICRkcml2ZXNUb1Byb2Nlc3MgPSBAKCIkRHJpdmVMZXR0ZXJgOiIpICMgQWRkIGNvbG9uIHRvIG1hdGNoIHRoZSBmb3JtYXQgKGUuZy4sICJDOiIpCiAgICB9CgogICAgJGFsbFNvcnRlZEl0ZW1zID0gW1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3Rbb2JqZWN0XV06Om5ldygpCgogICAgZm9yZWFjaCAoJGRyaXZlIGluICRkcml2ZXNUb1Byb2Nlc3MpIHsKICAgICAgICBpZiAoJFZlcmJvc2VPdXRwdXQpIHsKICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICJQcm9jZXNzaW5nIGRyaXZlICRkcml2ZSIKICAgICAgICB9CgogICAgICAgICMgRXh0cmFjdCB0aGUgZHJpdmUgbGV0dGVyIHdpdGhvdXQgY29sb24KICAgICAgICAkZHJpdmVMZXR0ZXJPbmx5ID0gJGRyaXZlLlRyaW1FbmQoJzonKQoKICAgICAgICB0cnkgewogICAgICAgICAgICAkZm9sZGVyU2l6ZUNhbGN1bGF0b3IgPSBOZXctT2JqZWN0IEZvbGRlclNpemVDYWxjdWxhdG9yTmFtZXNwYWNlLkZvbGRlclNpemVDYWxjdWxhdG9yKCRkcml2ZUxldHRlck9ubHksICRNYXhEZXB0aCwgW2Jvb2xdJFZlcmJvc2VPdXRwdXQpCiAgICAgICAgICAgICRmb2xkZXJTaXplQ2FsY3VsYXRvci5DYWxjdWxhdGVGb2xkZXJTaXplcygpCiAgICAgICAgICAgICRpdGVtcyA9ICRmb2xkZXJTaXplQ2FsY3VsYXRvci5JdGVtcwogICAgICAgIH0KICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgIkZhaWxlZCB0byBjYWxjdWxhdGUgZm9sZGVyIHNpemVzIGZvciBkcml2ZSAkZHJpdmUgOiAkXyIKICAgICAgICAgICAgY29udGludWUKICAgICAgICB9CgogICAgICAgIGlmICgkaXRlbXMuQ291bnQgLWVxIDApIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiTm8gaXRlbXMgd2VyZSBmb3VuZCBvbiBkcml2ZSAkZHJpdmUuIEVuc3VyZSB0aGF0IHRoZSBkcml2ZSBpcyBhY2Nlc3NpYmxlLiIKICAgICAgICAgICAgY29udGludWUKICAgICAgICB9CgogICAgICAgICMgRmlsdGVyIGl0ZW1zIGJhc2VkIG9uIHBhcmFtZXRlcnMKICAgICAgICAkc2VsZWN0ZWRJdGVtcyA9ICRpdGVtcwoKICAgICAgICBpZiAoJEZvbGRlclNpemUgLWFuZCAtbm90ICRGaWxlU2l6ZSkgewogICAgICAgICAgICAkc2VsZWN0ZWRJdGVtcyA9ICRpdGVtcyB8IFdoZXJlLU9iamVjdCB7ICRfLklzRGlyZWN0b3J5IH0KICAgICAgICB9IGVsc2VpZiAoJEZpbGVTaXplIC1hbmQgLW5vdCAkRm9sZGVyU2l6ZSkgewogICAgICAgICAgICAkc2VsZWN0ZWRJdGVtcyA9ICRpdGVtcyB8IFdoZXJlLU9iamVjdCB7IC1ub3QgJF8uSXNEaXJlY3RvcnkgfQogICAgICAgIH0gZWxzZWlmICgtbm90ICRGb2xkZXJTaXplIC1hbmQgLW5vdCAkRmlsZVNpemUpIHsKICAgICAgICAgICAgIyBJZiBuZWl0aGVyIGlzIHNwZWNpZmllZCwgZGVmYXVsdCB0byBmb2xkZXJzIG9ubHkKICAgICAgICAgICAgJHNlbGVjdGVkSXRlbXMgPSAkaXRlbXMgfCBXaGVyZS1PYmplY3QgeyAkXy5Jc0RpcmVjdG9yeSB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIyBCb3RoIEZvbGRlclNpemUgYW5kIEZpbGVTaXplIGFyZSBzcGVjaWZpZWQ7IGluY2x1ZGUgYWxsIGl0ZW1zCiAgICAgICAgICAgICRzZWxlY3RlZEl0ZW1zID0gJGl0ZW1zCiAgICAgICAgfQoKICAgICAgICAjIFByb2Nlc3MgYW5kIHNvcnQgdGhlIHNlbGVjdGVkIGl0ZW1zCiAgICAgICAgJHNvcnRlZEl0ZW1zID0gJHNlbGVjdGVkSXRlbXMgfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgU2l6ZU9uRGlzayAtRGVzY2VuZGluZyB8IFNlbGVjdC1PYmplY3QgLUZpcnN0ICRUb3AgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIFtQU0N1c3RvbU9iamVjdF1AewogICAgICAgICAgICAgICAgRHJpdmUgICAgICAgICA9ICRkcml2ZQogICAgICAgICAgICAgICAgUGF0aCAgICAgICAgICA9ICRfLlBhdGgKICAgICAgICAgICAgICAgIFNpemUgICAgICAgICAgPSBDb252ZXJ0LUJ5dGVzVG9TaXplIC1CeXRlcyAkXy5TaXplT25EaXNrCiAgICAgICAgICAgICAgICBDcmVhdGlvblRpbWUgID0gJF8uQ3JlYXRpb25UaW1lCiAgICAgICAgICAgICAgICBMYXN0V3JpdGVUaW1lID0gJF8uTGFzdFdyaXRlVGltZQogICAgICAgICAgICAgICAgSXNEaXJlY3RvcnkgICA9ICRfLklzRGlyZWN0b3J5CiAgICAgICAgICAgICAgICBSb3dDb2xvdXIgICAgID0gc3dpdGNoICgkXy5TaXplT25EaXNrKSB7CiAgICAgICAgICAgICAgICAgICAgeyAkXyAtZ3QgMzBHQiB9IHsgImRhbmdlciI7IGJyZWFrIH0KICAgICAgICAgICAgICAgICAgICB7ICRfIC1ndCA1R0IgfSAgeyAid2FybmluZyI7IGJyZWFrIH0KICAgICAgICAgICAgICAgICAgICB7ICRfIC1ndCAxR0IgfSAgeyAiaW5mbyI7IGJyZWFrIH0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0ICAgICAgICAgeyAiZGVmYXVsdCIgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIEFkZCB0aGUgc29ydGVkIGl0ZW1zIGZvciB0aGlzIGRyaXZlIHRvIHRoZSBsaXN0IG9mIGFsbCBpdGVtcwogICAgICAgICRhbGxTb3J0ZWRJdGVtcy5BZGRSYW5nZSgkc29ydGVkSXRlbXMpCiAgICB9CgogICAgIyBSZXR1cm4gYWxsIHNvcnRlZCBpdGVtcwogICAgcmV0dXJuICRhbGxTb3J0ZWRJdGVtcwp9CgpmdW5jdGlvbiBDb252ZXJ0LUJ5dGVzVG9TaXplIHsKICAgIHBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICR0cnVlKV0KICAgICAgICBbbG9uZ10kQnl0ZXMKICAgICkKCiAgICAkc2l6ZXMgPSAiYnl0ZXMiLCAiS0IiLCAiTUIiLCAiR0IiLCAiVEIiLCAiUEIiLCAiRUIiCiAgICAkZmFjdG9yID0gMAoKICAgIHdoaWxlICgkQnl0ZXMgLWdlIDFLQiAtYW5kICRmYWN0b3IgLWx0ICRzaXplcy5MZW5ndGggLSAxKSB7CiAgICAgICAgJEJ5dGVzIC89IDFLQgogICAgICAgICRmYWN0b3IrKwogICAgfQoKICAgIHJldHVybiAiezA6TjJ9IHsxfSIgLWYgJEJ5dGVzLCAkc2l6ZXNbJGZhY3Rvcl0KfQpmdW5jdGlvbiBDb252ZXJ0VG8tT2JqZWN0VG9IdG1sVGFibGUgewogICAgcGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5MaXN0W09iamVjdF1dJE9iamVjdHMKICAgICkKICAgICRzYiA9IE5ldy1PYmplY3QgU3lzdGVtLlRleHQuU3RyaW5nQnVpbGRlcgogICAgIyBTdGFydCB0aGUgSFRNTCB0YWJsZQogICAgW3ZvaWRdJHNiLkFwcGVuZCgnPHRhYmxlPjx0aGVhZD48dHI+JykKICAgICMgQWRkIGNvbHVtbiBoZWFkZXJzIGJhc2VkIG9uIHRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBmaXJzdCBvYmplY3QsIGV4Y2x1ZGluZyAiUm93Q29sb3VyIgogICAgJE9iamVjdHNbMF0uUFNPYmplY3QuUHJvcGVydGllcy5OYW1lIHwKICAgIFdoZXJlLU9iamVjdCB7ICRfIC1uZSAnUm93Q29sb3VyJyB9IHwKICAgIEZvckVhY2gtT2JqZWN0IHsgW3ZvaWRdJHNiLkFwcGVuZCgiPHRoPiRfPC90aD4iKSB9CgogICAgW3ZvaWRdJHNiLkFwcGVuZCgnPC90cj48L3RoZWFkPjx0Ym9keT4nKQogICAgZm9yZWFjaCAoJG9iaiBpbiAkT2JqZWN0cykgewogICAgICAgICMgVXNlIHRoZSBSb3dDb2xvdXIgcHJvcGVydHkgZnJvbSB0aGUgb2JqZWN0IHRvIHNldCB0aGUgY2xhc3MgZm9yIHRoZSByb3cKICAgICAgICAkcm93Q2xhc3MgPSBpZiAoJG9iai5Sb3dDb2xvdXIpIHsgJG9iai5Sb3dDb2xvdXIgfSBlbHNlIHsgIiIgfQoKICAgICAgICBbdm9pZF0kc2IuQXBwZW5kKCI8dHIgY2xhc3M9YCIkcm93Q2xhc3NgIj4iKQogICAgICAgICMgR2VuZXJhdGUgdGFibGUgY2VsbHMsIGV4Y2x1ZGluZyAiUm93Q29sb3VyIgogICAgICAgIGZvcmVhY2ggKCRwcm9wTmFtZSBpbiAkb2JqLlBTT2JqZWN0LlByb3BlcnRpZXMuTmFtZSB8IFdoZXJlLU9iamVjdCB7ICRfIC1uZSAnUm93Q29sb3VyJyB9KSB7CiAgICAgICAgICAgIFt2b2lkXSRzYi5BcHBlbmQoIjx0ZD4kKCRvYmouJHByb3BOYW1lKTwvdGQ+IikKICAgICAgICB9CiAgICAgICAgW3ZvaWRdJHNiLkFwcGVuZCgnPC90cj4nKQogICAgfQogICAgW3ZvaWRdJHNiLkFwcGVuZCgnPC90Ym9keT48L3RhYmxlPicpCiAgICAkT3V0cHV0TGVuZ3RoID0gJHNiLlRvU3RyaW5nKCkgfCBNZWFzdXJlLU9iamVjdCAtQ2hhcmFjdGVyIC1JZ25vcmVXaGl0ZVNwYWNlIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgQ2hhcmFjdGVycwogICAgaWYgKCRPdXRwdXRMZW5ndGggLWd0IDIwMDAwMCkgewogICAgICAgIFdyaXRlLVdhcm5pbmcgKCdPdXRwdXQgYXBwZWFycyB0byBiZSBvdmVyIHRoZSBOaW5qYU9uZSBXWVNJV1lHIGZpZWxkIGxpbWl0IG9mIDIwMCwwMDAgY2hhcmFjdGVycy4gQWN0dWFsIGxlbmd0aCB3YXM6IHswfScgLWYgJE91dHB1dExlbmd0aCkKICAgIH0KICAgIHJldHVybiAkc2IuVG9TdHJpbmcoKQp9CgojIEdlbmVyYXRlIHRoZSBUcmVlc2l6ZSByZXBvcnQKJHJlc3VsdHMgPSBHZXQtRm9sZGVyU2l6ZXMgLUFsbERyaXZlcyAtTWF4RGVwdGggNSAtVG9wIDQwIC1Gb2xkZXJTaXplIC1GaWxlU2l6ZQoKIyBDb252ZXJ0IHRoZSByZXN1bHRzIHRvIGFuIEhUTUwgdGFibGUKQ29udmVydFRvLU9iamVjdFRvSHRtbFRhYmxlIC1PYmplY3RzICRyZXN1bHRzIHwgTmluamEtUHJvcGVydHktU2V0LVBpcGVkIGN1c3RvbUZpZWxkTmFtZQ==",
  "scriptParameters": [],
  "defaultRunAs": "system",
  "useFirstParametersOptionAsDefault": false
}