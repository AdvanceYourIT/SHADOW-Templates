{
  "name": "CF-UltraTreesizeNinja",
  "description": "https://github.com/freezscholte/Public-Ninja-Scripts/blob/main/CF-Treesize/CF-UltraTreesizeNinja.ps1",
  "categoriesIds": [
    8
  ],
  "architecture": [
    "64",
    "32"
  ],
  "language": "powershell",
  "operatingSystems": [
    "Windows"
  ],
  "code": "CjwjCi5TWU5PUFNJUwogICAgQ2FsY3VsYXRlIHRoZSBzaXplcyBvZiBmb2xkZXJzIGZyb20gdGhlIE1hc3RlciBGaWxlIFRhYmxlIHVzaW5nIEMjIG9uIGEgZHJpdmUgYW5kIG91dHB1dCB0aGUgcmVzdWx0cyBpbiBhbiBIVE1MIHRhYmxlLgoKLkRFU0NSSVBUSU9OCiAgICBUaGlzIHNjcmlwdCBjYWxjdWxhdGVzIHRoZSBzaXplcyBvZiBmb2xkZXJzIGZyb20gdGhlIE1hc3RlciBGaWxlIFRhYmxlIChNRlQpIHVzaW5nIEMjIG9uIGEgc3BlY2lmaWVkIGRyaXZlIGFuZCBvdXRwdXRzIHRoZSByZXN1bHRzIGluIGFuIEhUTUwgdGFibGUuCiAgICBUaGUgc2NyaXB0IHVzZXMgYSBjb21waWxlZCBDIyBjbGFzcyB0byByZWFkIHRoZSBNRlQgcmVjb3JkcyBhbmQgY2FsY3VsYXRlIHRoZSBzaXplcyBvZiBmb2xkZXJzIHJlY3Vyc2l2ZWx5LgogICAgVGhlIHJlc3VsdHMgYXJlIGRpc3BsYXllZCBpbiBhbiBIVE1MIHRhYmxlIHdpdGggdGhlIHRvcCBmb2xkZXJzIGJ5IHNpemUsIGFuZCB0aGUgcm93IGNvbG9yIGlzIGJhc2VkIG9uIHRoZSBzaXplIG9mIHRoZSBmb2xkZXIuCiAgICBUaGlzIHNjcmlwdCB3cml0ZXMgdGhlIGRhdGEgdG8gdGhlIEN1c3RvbSBGaWVsZCBuYW1lZCB0cmVlc2l6ZS4KCi5OT1RFUwogICAgRmlsZSBOYW1lICAgICAgOiBDRi1VbHRyYVRyZWVzaXplTmluamEucHMxCiAgICBBdXRob3IgICAgICAgICA6IEphbiBTY2hvbHRlCiAgICBWZXJzaW9uICAgICAgICA6IDAuOS4xIFJDCiM+CgpBZGQtVHlwZSAtVHlwZURlZmluaXRpb24gQCIKdXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuQ29uY3VycmVudDsKdXNpbmcgU3lzdGVtLklPOwp1c2luZyBTeXN0ZW0uTGlucTsKdXNpbmcgU3lzdGVtLlRocmVhZGluZzsKdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOwp1c2luZyBTeXN0ZW0uQ29tcG9uZW50TW9kZWw7CgpuYW1lc3BhY2UgRm9sZGVyU2l6ZUNhbGN1bGF0b3JOYW1lc3BhY2UKewogICAgcHVibGljIGNsYXNzIEZpbGVTeXN0ZW1JdGVtCiAgICB7CiAgICAgICAgcHVibGljIHN0cmluZyBQYXRoIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgbG9uZyBTaXplT25EaXNrIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgRGF0ZVRpbWUgQ3JlYXRpb25UaW1lIHsgZ2V0OyBzZXQ7IH0KICAgICAgICBwdWJsaWMgRGF0ZVRpbWUgTGFzdFdyaXRlVGltZSB7IGdldDsgc2V0OyB9CiAgICAgICAgcHVibGljIGJvb2wgSXNEaXJlY3RvcnkgeyBnZXQ7IHNldDsgfQogICAgfQoKICAgIHB1YmxpYyBjbGFzcyBGb2xkZXJTaXplQ2FsY3VsYXRvcgogICAgewogICAgICAgIHByaXZhdGUgc3RyaW5nIGRyaXZlTGV0dGVyOwogICAgICAgIHByaXZhdGUgaW50IG1heERlcHRoOwogICAgICAgIHByaXZhdGUgYm9vbCB2ZXJib3NlT3V0cHV0OwogICAgICAgIHByaXZhdGUgbG9uZyBzaXplVGhyZXNob2xkOwogICAgICAgIHB1YmxpYyBDb25jdXJyZW50QmFnPEZpbGVTeXN0ZW1JdGVtPiBJdGVtcyB7IGdldDsgcHJpdmF0ZSBzZXQ7IH0KCiAgICAgICAgcHVibGljIEZvbGRlclNpemVDYWxjdWxhdG9yKHN0cmluZyBkcml2ZUxldHRlciwgaW50IG1heERlcHRoLCBib29sIHZlcmJvc2VPdXRwdXQsIGxvbmcgc2l6ZVRocmVzaG9sZCA9IDEwMjQgKiAxMDI0KQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5kcml2ZUxldHRlciA9IGRyaXZlTGV0dGVyOwogICAgICAgICAgICB0aGlzLm1heERlcHRoID0gbWF4RGVwdGg7CiAgICAgICAgICAgIHRoaXMudmVyYm9zZU91dHB1dCA9IHZlcmJvc2VPdXRwdXQ7CiAgICAgICAgICAgIHRoaXMuc2l6ZVRocmVzaG9sZCA9IHNpemVUaHJlc2hvbGQ7CiAgICAgICAgICAgIHRoaXMuSXRlbXMgPSBuZXcgQ29uY3VycmVudEJhZzxGaWxlU3lzdGVtSXRlbT4oKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIENhbGN1bGF0ZUZvbGRlclNpemVzKCkKICAgICAgICB7CiAgICAgICAgICAgIERpcmVjdG9yeUluZm8gcm9vdERpciA9IG5ldyBEaXJlY3RvcnlJbmZvKHRoaXMuZHJpdmVMZXR0ZXIgKyAiOlxcIik7CiAgICAgICAgICAgIENhbGN1bGF0ZUZvbGRlclNpemUocm9vdERpciwgMCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGxvbmcgQ2FsY3VsYXRlRm9sZGVyU2l6ZShEaXJlY3RvcnlJbmZvIGRpckluZm8sIGludCBjdXJyZW50RGVwdGgpCiAgICAgICAgewogICAgICAgICAgICBpZiAoY3VycmVudERlcHRoID4gdGhpcy5tYXhEZXB0aCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvbmcgZm9sZGVyU2l6ZU9uRGlzayA9IDA7CgogICAgICAgICAgICB2YXIgcGFyYWxsZWxPcHRpb25zID0gbmV3IFBhcmFsbGVsT3B0aW9ucyB7IE1heERlZ3JlZU9mUGFyYWxsZWxpc20gPSBFbnZpcm9ubWVudC5Qcm9jZXNzb3JDb3VudCB9OwoKICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgZmlsZXMgaW4gdGhlIGN1cnJlbnQgZGlyZWN0b3J5CiAgICAgICAgICAgICAgICB2YXIgZmlsZXMgPSBFbnVtZXJhYmxlLkVtcHR5PEZpbGVJbmZvPigpOwogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZmlsZXMgPSBkaXJJbmZvLkVudW1lcmF0ZUZpbGVzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlcmJvc2VPdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiRXJyb3IgYWNjZXNzaW5nIGZpbGVzIGluIGRpcmVjdG9yeSB7MH06IHsxfSIsIGRpckluZm8uRnVsbE5hbWUsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBQYXJhbGxlbC5Gb3JFYWNoKGZpbGVzLCBwYXJhbGxlbE9wdGlvbnMsIGZpbGUgPT4KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcgZmlsZVNpemVPbkRpc2sgPSBHZXRTaXplT25EaXNrKGZpbGUuRnVsbE5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG5ldyBGaWxlU3lzdGVtSXRlbQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXRoID0gZmlsZS5GdWxsTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemVPbkRpc2sgPSBmaWxlU2l6ZU9uRGlzaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0aW9uVGltZSA9IGZpbGUuQ3JlYXRpb25UaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGFzdFdyaXRlVGltZSA9IGZpbGUuTGFzdFdyaXRlVGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElzRGlyZWN0b3J5ID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVTaXplT25EaXNrID4gc2l6ZVRocmVzaG9sZCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgSXRlbXMuQWRkKGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBJbnRlcmxvY2tlZC5BZGQocmVmIGZvbGRlclNpemVPbkRpc2ssIGZpbGVTaXplT25EaXNrKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlcmJvc2VPdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJFcnJvciBwcm9jZXNzaW5nIGZpbGUgezB9OiB7MX0iLCBmaWxlLkZ1bGxOYW1lLCBleC5NZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIFByb2Nlc3Mgc3ViZGlyZWN0b3JpZXMKICAgICAgICAgICAgICAgIHZhciBzdWJEaXJzID0gRW51bWVyYWJsZS5FbXB0eTxEaXJlY3RvcnlJbmZvPigpOwogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc3ViRGlycyA9IGRpckluZm8uRW51bWVyYXRlRGlyZWN0b3JpZXMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudmVyYm9zZU91dHB1dCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJFcnJvciBhY2Nlc3Npbmcgc3ViZGlyZWN0b3JpZXMgaW4gZGlyZWN0b3J5IHswfTogezF9IiwgZGlySW5mby5GdWxsTmFtZSwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFBhcmFsbGVsLkZvckVhY2goc3ViRGlycywgcGFyYWxsZWxPcHRpb25zLCBzdWJEaXIgPT4KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0cnkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcgc3ViRGlyU2l6ZU9uRGlzayA9IENhbGN1bGF0ZUZvbGRlclNpemUoc3ViRGlyLCBjdXJyZW50RGVwdGggKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgSW50ZXJsb2NrZWQuQWRkKHJlZiBmb2xkZXJTaXplT25EaXNrLCBzdWJEaXJTaXplT25EaXNrKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbiBleCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnZlcmJvc2VPdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJFcnJvciBwcm9jZXNzaW5nIGRpcmVjdG9yeSB7MH06IHsxfSIsIHN1YkRpci5GdWxsTmFtZSwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgRmlsZVN5c3RlbUl0ZW0gZm9yIHRoZSBjdXJyZW50IGRpcmVjdG9yeQogICAgICAgICAgICAgICAgdmFyIGRpckl0ZW0gPSBuZXcgRmlsZVN5c3RlbUl0ZW0KICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBQYXRoID0gZGlySW5mby5GdWxsTmFtZSwKICAgICAgICAgICAgICAgICAgICBTaXplT25EaXNrID0gZm9sZGVyU2l6ZU9uRGlzaywKICAgICAgICAgICAgICAgICAgICBDcmVhdGlvblRpbWUgPSBkaXJJbmZvLkNyZWF0aW9uVGltZSwKICAgICAgICAgICAgICAgICAgICBMYXN0V3JpdGVUaW1lID0gZGlySW5mby5MYXN0V3JpdGVUaW1lLAogICAgICAgICAgICAgICAgICAgIElzRGlyZWN0b3J5ID0gdHJ1ZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIEl0ZW1zLkFkZChkaXJJdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy52ZXJib3NlT3V0cHV0KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJFcnJvciBhY2Nlc3NpbmcgZGlyZWN0b3J5IHswfTogezF9IiwgZGlySW5mby5GdWxsTmFtZSwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmb2xkZXJTaXplT25EaXNrOwogICAgICAgIH0KCiAgICAgICAgW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yID0gdHJ1ZSwgQ2hhclNldCA9IENoYXJTZXQuQXV0byldCiAgICAgICAgc3RhdGljIGV4dGVybiB1aW50IEdldENvbXByZXNzZWRGaWxlU2l6ZShzdHJpbmcgbHBGaWxlTmFtZSwgb3V0IHVpbnQgbHBGaWxlU2l6ZUhpZ2gpOwoKICAgICAgICBwdWJsaWMgc3RhdGljIGxvbmcgR2V0U2l6ZU9uRGlzayhzdHJpbmcgZmlsZW5hbWUpCiAgICAgICAgewogICAgICAgICAgICB1aW50IGhpZ2hPcmRlcjsKICAgICAgICAgICAgdWludCBsb3dPcmRlciA9IEdldENvbXByZXNzZWRGaWxlU2l6ZShmaWxlbmFtZSwgb3V0IGhpZ2hPcmRlcik7CiAgICAgICAgICAgIGlmIChsb3dPcmRlciA9PSAweEZGRkZGRkZGKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpbnQgZXJyb3IgPSBNYXJzaGFsLkdldExhc3RXaW4zMkVycm9yKCk7CiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgIT0gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgV2luMzJFeGNlcHRpb24oZXJyb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoKGxvbmcpaGlnaE9yZGVyIDw8IDMyKSArIGxvd09yZGVyOwogICAgICAgIH0KICAgIH0KfQoiQApmdW5jdGlvbiBHZXQtRm9sZGVyU2l6ZXMgewogICAgcGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJGZhbHNlKV0KICAgICAgICBbc3RyaW5nXSREcml2ZUxldHRlciwKICAgICAgICBbaW50XSRNYXhEZXB0aCA9IDUsCiAgICAgICAgW2ludF0kVG9wID0gMjAsCiAgICAgICAgW1N3aXRjaF0kRm9sZGVyU2l6ZSwKICAgICAgICBbU3dpdGNoXSRGaWxlU2l6ZSwKICAgICAgICBbU3dpdGNoXSRWZXJib3NlT3V0cHV0LAogICAgICAgIFtTd2l0Y2hdJEFsbERyaXZlcwogICAgKQoKICAgICMgVmFsaWRhdGUgcGFyYW1ldGVycwogICAgaWYgKC1ub3QgJEFsbERyaXZlcyAtYW5kIC1ub3QgJERyaXZlTGV0dGVyKSB7CiAgICAgICAgdGhyb3cgIllvdSBtdXN0IHNwZWNpZnkgZWl0aGVyIC1Ecml2ZUxldHRlciBvciAtQWxsRHJpdmVzLiIKICAgIH0KCiAgICAjIEdldCBsaXN0IG9mIGRyaXZlcyB0byBwcm9jZXNzCiAgICAkZHJpdmVzVG9Qcm9jZXNzID0gQCgpCiAgICBpZiAoJEFsbERyaXZlcykgewogICAgICAgICMgR2V0IGFsbCBsb2NhbCBkcml2ZXMgKGV4Y2x1ZGluZyByZW1vdmFibGUgYW5kIG5ldHdvcmsgZHJpdmVzKQogICAgICAgICRkcml2ZXMgPSBHZXQtQ2ltSW5zdGFuY2UgV2luMzJfTG9naWNhbERpc2sgfCBXaGVyZS1PYmplY3QgewogICAgICAgICAgICAkXy5Ecml2ZVR5cGUgLWVxIDMgIyBEcml2ZVR5cGUgMyA9IExvY2FsIERpc2sKICAgICAgICB9CiAgICAgICAgJGRyaXZlc1RvUHJvY2VzcyA9ICRkcml2ZXMuRGV2aWNlSUQKICAgIH0gZWxzZSB7CiAgICAgICAgJGRyaXZlc1RvUHJvY2VzcyA9IEAoIiREcml2ZUxldHRlcmA6IikgIyBBZGQgY29sb24gdG8gbWF0Y2ggdGhlIGZvcm1hdCAoZS5nLiwgIkM6IikKICAgIH0KCiAgICAkYWxsU29ydGVkSXRlbXMgPSBbU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuTGlzdFtvYmplY3RdXTo6bmV3KCkKCiAgICBmb3JlYWNoICgkZHJpdmUgaW4gJGRyaXZlc1RvUHJvY2VzcykgewogICAgICAgIGlmICgkVmVyYm9zZU91dHB1dCkgewogICAgICAgICAgICBXcml0ZS1PdXRwdXQgIlByb2Nlc3NpbmcgZHJpdmUgJGRyaXZlIgogICAgICAgIH0KCiAgICAgICAgIyBFeHRyYWN0IHRoZSBkcml2ZSBsZXR0ZXIgd2l0aG91dCBjb2xvbgogICAgICAgICRkcml2ZUxldHRlck9ubHkgPSAkZHJpdmUuVHJpbUVuZCgnOicpCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRmb2xkZXJTaXplQ2FsY3VsYXRvciA9IE5ldy1PYmplY3QgRm9sZGVyU2l6ZUNhbGN1bGF0b3JOYW1lc3BhY2UuRm9sZGVyU2l6ZUNhbGN1bGF0b3IoJGRyaXZlTGV0dGVyT25seSwgJE1heERlcHRoLCBbYm9vbF0kVmVyYm9zZU91dHB1dCkKICAgICAgICAgICAgJGZvbGRlclNpemVDYWxjdWxhdG9yLkNhbGN1bGF0ZUZvbGRlclNpemVzKCkKICAgICAgICAgICAgJGl0ZW1zID0gJGZvbGRlclNpemVDYWxjdWxhdG9yLkl0ZW1zCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiRmFpbGVkIHRvIGNhbGN1bGF0ZSBmb2xkZXIgc2l6ZXMgZm9yIGRyaXZlICRkcml2ZSA6ICRfIgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgaWYgKCRpdGVtcy5Db3VudCAtZXEgMCkgewogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJObyBpdGVtcyB3ZXJlIGZvdW5kIG9uIGRyaXZlICRkcml2ZS4gRW5zdXJlIHRoYXQgdGhlIGRyaXZlIGlzIGFjY2Vzc2libGUuIgogICAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgIyBGaWx0ZXIgaXRlbXMgYmFzZWQgb24gcGFyYW1ldGVycwogICAgICAgICRzZWxlY3RlZEl0ZW1zID0gJGl0ZW1zCgogICAgICAgIGlmICgkRm9sZGVyU2l6ZSAtYW5kIC1ub3QgJEZpbGVTaXplKSB7CiAgICAgICAgICAgICRzZWxlY3RlZEl0ZW1zID0gJGl0ZW1zIHwgV2hlcmUtT2JqZWN0IHsgJF8uSXNEaXJlY3RvcnkgfQogICAgICAgIH0gZWxzZWlmICgkRmlsZVNpemUgLWFuZCAtbm90ICRGb2xkZXJTaXplKSB7CiAgICAgICAgICAgICRzZWxlY3RlZEl0ZW1zID0gJGl0ZW1zIHwgV2hlcmUtT2JqZWN0IHsgLW5vdCAkXy5Jc0RpcmVjdG9yeSB9CiAgICAgICAgfSBlbHNlaWYgKC1ub3QgJEZvbGRlclNpemUgLWFuZCAtbm90ICRGaWxlU2l6ZSkgewogICAgICAgICAgICAjIElmIG5laXRoZXIgaXMgc3BlY2lmaWVkLCBkZWZhdWx0IHRvIGZvbGRlcnMgb25seQogICAgICAgICAgICAkc2VsZWN0ZWRJdGVtcyA9ICRpdGVtcyB8IFdoZXJlLU9iamVjdCB7ICRfLklzRGlyZWN0b3J5IH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAjIEJvdGggRm9sZGVyU2l6ZSBhbmQgRmlsZVNpemUgYXJlIHNwZWNpZmllZDsgaW5jbHVkZSBhbGwgaXRlbXMKICAgICAgICAgICAgJHNlbGVjdGVkSXRlbXMgPSAkaXRlbXMKICAgICAgICB9CgogICAgICAgICMgUHJvY2VzcyBhbmQgc29ydCB0aGUgc2VsZWN0ZWQgaXRlbXMKICAgICAgICAkc29ydGVkSXRlbXMgPSAkc2VsZWN0ZWRJdGVtcyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSBTaXplT25EaXNrIC1EZXNjZW5kaW5nIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgJFRvcCB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgW1BTQ3VzdG9tT2JqZWN0XUB7CiAgICAgICAgICAgICAgICBEcml2ZSAgICAgICAgID0gJGRyaXZlCiAgICAgICAgICAgICAgICBQYXRoICAgICAgICAgID0gJF8uUGF0aAogICAgICAgICAgICAgICAgU2l6ZSAgICAgICAgICA9IENvbnZlcnQtQnl0ZXNUb1NpemUgLUJ5dGVzICRfLlNpemVPbkRpc2sKICAgICAgICAgICAgICAgIENyZWF0aW9uVGltZSAgPSAkXy5DcmVhdGlvblRpbWUKICAgICAgICAgICAgICAgIExhc3RXcml0ZVRpbWUgPSAkXy5MYXN0V3JpdGVUaW1lCiAgICAgICAgICAgICAgICBJc0RpcmVjdG9yeSAgID0gJF8uSXNEaXJlY3RvcnkKICAgICAgICAgICAgICAgIFJvd0NvbG91ciAgICAgPSBzd2l0Y2ggKCRfLlNpemVPbkRpc2spIHsKICAgICAgICAgICAgICAgICAgICB7ICRfIC1ndCAzMEdCIH0geyAiZGFuZ2VyIjsgYnJlYWsgfQogICAgICAgICAgICAgICAgICAgIHsgJF8gLWd0IDVHQiB9ICB7ICJ3YXJuaW5nIjsgYnJlYWsgfQogICAgICAgICAgICAgICAgICAgIHsgJF8gLWd0IDFHQiB9ICB7ICJpbmZvIjsgYnJlYWsgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQgICAgICAgICB7ICJkZWZhdWx0IiB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgQWRkIHRoZSBzb3J0ZWQgaXRlbXMgZm9yIHRoaXMgZHJpdmUgdG8gdGhlIGxpc3Qgb2YgYWxsIGl0ZW1zCiAgICAgICAgJGFsbFNvcnRlZEl0ZW1zLkFkZFJhbmdlKCRzb3J0ZWRJdGVtcykKICAgIH0KCiAgICAjIFJldHVybiBhbGwgc29ydGVkIGl0ZW1zCiAgICByZXR1cm4gJGFsbFNvcnRlZEl0ZW1zCn0KCmZ1bmN0aW9uIENvbnZlcnQtQnl0ZXNUb1NpemUgewogICAgcGFyYW0gKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5ID0gJHRydWUpXQogICAgICAgIFtsb25nXSRCeXRlcwogICAgKQoKICAgICRzaXplcyA9ICJieXRlcyIsICJLQiIsICJNQiIsICJHQiIsICJUQiIsICJQQiIsICJFQiIKICAgICRmYWN0b3IgPSAwCgogICAgd2hpbGUgKCRCeXRlcyAtZ2UgMUtCIC1hbmQgJGZhY3RvciAtbHQgJHNpemVzLkxlbmd0aCAtIDEpIHsKICAgICAgICAkQnl0ZXMgLz0gMUtCCiAgICAgICAgJGZhY3RvcisrCiAgICB9CgogICAgcmV0dXJuICJ7MDpOMn0gezF9IiAtZiAkQnl0ZXMsICRzaXplc1skZmFjdG9yXQp9CmZ1bmN0aW9uIENvbnZlcnRUby1PYmplY3RUb0h0bWxUYWJsZSB7CiAgICBwYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkdHJ1ZSldCiAgICAgICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLkxpc3RbT2JqZWN0XV0kT2JqZWN0cwogICAgKQogICAgJHNiID0gTmV3LU9iamVjdCBTeXN0ZW0uVGV4dC5TdHJpbmdCdWlsZGVyCiAgICAjIFN0YXJ0IHRoZSBIVE1MIHRhYmxlCiAgICBbdm9pZF0kc2IuQXBwZW5kKCc8dGFibGU+PHRoZWFkPjx0cj4nKQogICAgIyBBZGQgY29sdW1uIGhlYWRlcnMgYmFzZWQgb24gdGhlIHByb3BlcnRpZXMgb2YgdGhlIGZpcnN0IG9iamVjdCwgZXhjbHVkaW5nICJSb3dDb2xvdXIiCiAgICAkT2JqZWN0c1swXS5QU09iamVjdC5Qcm9wZXJ0aWVzLk5hbWUgfAogICAgV2hlcmUtT2JqZWN0IHsgJF8gLW5lICdSb3dDb2xvdXInIH0gfAogICAgRm9yRWFjaC1PYmplY3QgeyBbdm9pZF0kc2IuQXBwZW5kKCI8dGg+JF88L3RoPiIpIH0KCiAgICBbdm9pZF0kc2IuQXBwZW5kKCc8L3RyPjwvdGhlYWQ+PHRib2R5PicpCiAgICBmb3JlYWNoICgkb2JqIGluICRPYmplY3RzKSB7CiAgICAgICAgIyBVc2UgdGhlIFJvd0NvbG91ciBwcm9wZXJ0eSBmcm9tIHRoZSBvYmplY3QgdG8gc2V0IHRoZSBjbGFzcyBmb3IgdGhlIHJvdwogICAgICAgICRyb3dDbGFzcyA9IGlmICgkb2JqLlJvd0NvbG91cikgeyAkb2JqLlJvd0NvbG91ciB9IGVsc2UgeyAiIiB9CgogICAgICAgIFt2b2lkXSRzYi5BcHBlbmQoIjx0ciBjbGFzcz1gIiRyb3dDbGFzc2AiPiIpCiAgICAgICAgIyBHZW5lcmF0ZSB0YWJsZSBjZWxscywgZXhjbHVkaW5nICJSb3dDb2xvdXIiCiAgICAgICAgZm9yZWFjaCAoJHByb3BOYW1lIGluICRvYmouUFNPYmplY3QuUHJvcGVydGllcy5OYW1lIHwgV2hlcmUtT2JqZWN0IHsgJF8gLW5lICdSb3dDb2xvdXInIH0pIHsKICAgICAgICAgICAgW3ZvaWRdJHNiLkFwcGVuZCgiPHRkPiQoJG9iai4kcHJvcE5hbWUpPC90ZD4iKQogICAgICAgIH0KICAgICAgICBbdm9pZF0kc2IuQXBwZW5kKCc8L3RyPicpCiAgICB9CiAgICBbdm9pZF0kc2IuQXBwZW5kKCc8L3Rib2R5PjwvdGFibGU+JykKICAgICRPdXRwdXRMZW5ndGggPSAkc2IuVG9TdHJpbmcoKSB8IE1lYXN1cmUtT2JqZWN0IC1DaGFyYWN0ZXIgLUlnbm9yZVdoaXRlU3BhY2UgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBDaGFyYWN0ZXJzCiAgICBpZiAoJE91dHB1dExlbmd0aCAtZ3QgMjAwMDAwKSB7CiAgICAgICAgV3JpdGUtV2FybmluZyAoJ091dHB1dCBhcHBlYXJzIHRvIGJlIG92ZXIgdGhlIE5pbmphT25lIFdZU0lXWUcgZmllbGQgbGltaXQgb2YgMjAwLDAwMCBjaGFyYWN0ZXJzLiBBY3R1YWwgbGVuZ3RoIHdhczogezB9JyAtZiAkT3V0cHV0TGVuZ3RoKQogICAgfQogICAgcmV0dXJuICRzYi5Ub1N0cmluZygpCn0KCiMgR2VuZXJhdGUgdGhlIFRyZWVzaXplIHJlcG9ydAokcmVzdWx0cyA9IEdldC1Gb2xkZXJTaXplcyAtQWxsRHJpdmVzIC1NYXhEZXB0aCA1IC1Ub3AgNDAgLUZvbGRlclNpemUgLUZpbGVTaXplCgojIENvbnZlcnQgdGhlIHJlc3VsdHMgdG8gYW4gSFRNTCB0YWJsZQpDb252ZXJ0VG8tT2JqZWN0VG9IdG1sVGFibGUgLU9iamVjdHMgJHJlc3VsdHMgfCBOaW5qYS1Qcm9wZXJ0eS1TZXQtUGlwZWQgdHJlZXNpemU=",
  "scriptParameters": [],
  "defaultRunAs": "system",
  "useFirstParametersOptionAsDefault": false
}
